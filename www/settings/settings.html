<!DOCTYPE html>
<html>
    <head>
        <title>Homealone - Beállítások</title>
        
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
        <link type="text/css" rel="stylesheet" href="../style/style.css">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<script src="../lib/chart.min.js"></script>
		
        <script src="../common.js"></script>
        <script src="../js/graph.custom.js"></script>

        <script src="../js/script.js"></script>
        
		<script>
            indexFile = "/index.php";
			window.onload = function() {
                var username = "";
                
				getusername(function(success, name) {
					if(success) {
						username = name;
						document.getElementById("username").innerHTML = username;
					}
					else alert("Internal Server Error 500");
				} );


                $(".dropdown").click(function() {
                    $(this).children(".dropdown-content").fadeToggle("fast");
                    $(this).children(".dropbtn").toggleClass("active");
                });

                //js/graph.custom.js
                generateCardGraphs();
                
                //Generate sensor list.
                var sList;
                getsensorlistname(function(s, list) {
                    var div = document.getElementById("sensor-config");
                    sList = list;

                    for(var i = 0; i < list.length; i++) {

                        div.innerHTML += '<div class="spoiler" sensor="'+ list[i][0] +'"> <p>'+ list[i][1] +' ('+ list[i][0] +')</p> <div class="content"></div> </div>';

                    }
                        
                    for(var i = 0; i < list.length; i++) {
                        
                        getallconfig(list[i][0], function(s, configs, device) {
                            var content = "";
                            var div = getDivElementBySensor(device);
                            if(div == false) return false;

                            div = div.getElementsByClassName("content")[0];
                            
                            var container = true

                            content += "<form method='POST' sensor='"+device+"' action='/settings/index.php' style='text-align: center; margin-right: 20px;'>";

                            for(var c = 0; c < configs.length; c++) {
                                
                                //if(container) {
                                    //if(c != configs.length - 1) {
                                        content += "<div class='input-break'>";
                                        //container = false;
                                    //}else{
                                    //    content += "<br>";
                                    //}
                                //}
                                var type = "textbox";
                                var properties = "";

                                if(configs[c][2] == "0"){
                                    type = "number";
                                    properties = 'min="'+configs[c][3]+'" max="'+configs[c][4]+'" class="number"';
                                }

                                content += '<span>'+ configs[c][0] +'</span><br><span class="errormsg"></span><input type="textbox" '+properties+' name="'+ configs[c][0] +'" placeholder="'+ configs[c][1] +'" value=""/> <br>'
                                

                                //if((c + 1) % 2 == 0 && container == false) {
                                    content += "</div>";
                                    //container = true;
                                //}
                                
                    
                            }
                            
                            content += "<div>";
                            content += "<button>Mentés</button>";
                            content += "</div>";

                            content += "</form>";
                    
                            div.innerHTML = content;

                           
                           $($(div).children("form")).submit(function(e){
                               e.preventDefault();
                               submitConfigForm(this);

                            });
                            
                            $($(div).children("form").children("div").children("input.number")).bind('input', function() { 
                                    var min = $(this).attr("min");
                                    var max = $(this).attr("max");

                                    //alert("asdasdasdasasd");
                                    
                                    var errorElm = $(this).parent("div").children(".errormsg");
                                    
                                    if(isNaN($(this).val())) {
                                        errorElm.html("Számnak kell lennie.<br/>");
                                        errorElm.fadeIn(200);
                                        return;
                                    }

                                    if($(this).val() * 1 < min) {

                                        errorElm.html("Nem lehet kisebb, mint "+min+"<br/>");
                                        errorElm.fadeIn(200);
                                        return;
                                        //alert("he")
                                    }
                                        
                                    if($(this).val() * 1 > max) {
                                        errorElm.html("Nem lehet nagyobb, mint "+max+"<br/>");
                                        errorElm.fadeIn(200);
                                        return;
                                    }

                                    errorElm.fadeOut(200);
                                    //errorElm.html("");
                            });

                    
                        });

                        
                    }

                    spoilerHandler();

                });
                
            }
        </script>
		
    </head>
    <body>

        <nav>
            <div class="navbar clear">
                <div class="menu">
                    <ul>
                        <!-- <li><a href="#">menu 1</a></li> -->
                        <li><a href="#"><i class="fas fa-bell"></i></a></li>
                        <li>
                            <div class="dropdown right">
                                <a href="#" class="dropbtn"><i class="fas fa-user"></i></a>
                                <div class="dropdown-content">
                                    <p id="username">{Felhasználó}</p>
                                    <a href="#"><i class="fas fa-cog"></i> Beállítások</a>
                                    <a href="#" id="logout"><i class="fas fa-sign-out-alt"></i> Kijelentkezés</a>
                                </div>
                            </div>
                        </li>
                    </ul> 
                </div>
            </div>
        </nav>

        <div id="settings">
            <div id="settings-menu">
                <ul>
                    <li class="title"><p>Beállítások</p></li>
                    <li><a href="#">Profil</a></li>
                    <li><a href="#">Felhasználók</a></li>
                    <li><a href="#">Érzékelők</a></li>
                </ul>
                
            </div>

            <div id="settings-main">
                <div id="sensor-config">
                    <h3>Érzékelők</h3>
                    
                    <!--
                    <div class="spoiler">
                        <p>Füst érzékelő</p>
                        <div class="content">

                            <div style="display: inline-block;">
                            <span>display</span><br>
                            <input type="textbox" placeholder="asd" value="teszt"/>
                            <br>

                            <span>display</span><br>
                            <input type="textbox" value="teszt"/>
                            <br>
                            </div>

                            <div style="display: inline-block;">
                            <span>display</span><br>
                            <input type="textbox" value="teszt"/>
                            <br>

                            <span>display</span><br>
                            <input type="textbox" value="teszt"/>
                            </div>

                            <div style="display: inline-block;">
                            <span>display</span><br>
                            <input type="textbox" value="teszt"/>
                            <br>

                            <span>display</span><br>
                            <input type="textbox" value="teszt"/>
                            </div>

                        </div>
                    </div>

                    <div class="spoiler">
                        <p>Riasztó</p>
                        <div class="content">asdasdasdsadasd</div>
                    </div>
                    -->
                </div>
            </div>
        </div>
        
          
    </body>
</html>